!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("CustomEvent")):"function"==typeof define&&define.amd?define("Cage",["CustomEvent"],e):"object"==typeof exports?exports.Cage=e(require("CustomEvent")):t.Cage=e(t.CustomEvent)}(this,function(t){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(1),s=i(a),u=n(2),c=i(u),f=n(4),l=i(f);(0,s.default)();var d=function(){function t(e){o(this,t),this.outputs=e.outputs.map(function(t){var n={container:e.container,cageHtmlURL:e.cageHtmlURL,params:t};return new l.default(n)});var n={container:e.container,events:e.events,outputs:this.outputs};this.input=new c.default(n)}return r(t,[{key:"listenEvents",value:function(){this.input.start()}},{key:"start",value:function(){for(var t=0;t<this.outputs.length;t++)this.outputs[t].start()}},{key:"triggerEvent",value:function(t,e){this.input.trigerEvent(t,e)}}]),t}();t.exports=d},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){if("undefined"!=typeof window)try{new window.CustomEvent("",{})}catch(t){!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}()}}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(3),s=i(a),u=function(){function t(e){o(this,t),this.container=e.container,this.events=e.events,this.outputs=e.outputs}return r(t,[{key:"start",value:function(){for(var t=0;t<this.events.length;t++){var e=this.outputs;this.container.addEventListener(this.events[t],function(t){for(var n=0;n<e.length;n++)e[n].send(t)})}}},{key:"triggerEvent",value:function(t,e){this.container.dispatchEvent(new s.default(t,e))}}]),t}();e.default=u},function(e,n){e.exports=t},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(1),s=i(a);(0,s.default)();var u=function(){function t(e){o(this,t);var n=e.container,i=e.cageHtmlURL,r=e.params;this.cageHtmlURL=i||"/cage.html",this.events=[],this.ready=!1,this.container=n,this.permissions=r.permissions,this.id=r.id,this.onload=r.onload,this.srcdoc=!!("srcdoc"in this.container.createElement("iframe")),this.scripts=r.scripts,this.waitLoadUntilEvent=r.waitLoadUntilEvent}return r(t,[{key:"send",value:function(t){this.ready?this.iframe.contentWindow.postMessage(JSON.stringify({type:t.type,detail:t.detail,timeStamp:t.timeStamp}),"*"):this.events.push(t)}},{key:"start",value:function(){var t=this,e=document.createElement("iframe");e.style.display="none",window.addEventListener("message",function(e){var n;try{n="string"==typeof e.data?JSON.parse(e.data):JSON.parse(JSON.stringify(e.data))}catch(t){n={},console&&console.warn&&console.warn(t)}n.type==="cage:iframe:load:"+t.id&&(t.ready=!0,t.send(new CustomEvent("cage:load")),t.flush(),t.onload&&t.onload(t.id))},!0),this.srcdoc&&(e.sandbox="undefined"==typeof this.permissions?"":this.permissions.join(" ")),e.src=t.cageHtmlURL+"?outputID="+t.id,this.container.body.appendChild(e),this.iframe=e,window.addEventListener("message",function(n){var i=JSON.parse(n.data),o=i.type;o==="cage:iframe:domcontentloaded:"+t.id&&e.contentWindow.postMessage(JSON.stringify({type:"cage:configuration",data:{scripts:t.scripts,waitLoadUntilEvent:t.waitLoadUntilEvent}}),"*")},!1)}},{key:"flush",value:function(){for(;this.events.length>0;)this.send(this.events.pop())}}]),t}();e.default=u}])});